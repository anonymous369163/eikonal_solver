# SAMRoute config — Phase 1: road segmentation only
#
# Train road segmentation decoder from a pretrained SAMRoad checkpoint.
# Encoder is frozen; only the lightweight map_decoder is updated.
# Dual-target training: BCE on thick mask (recall) + Dice on thin mask (precision).
#
# Usage:
#   bash eikonal_solver/run_train.sh --phase 1 --epochs 200

# ---- SAM backbone ----
NO_SAM: False
SAM_VERSION: 'vit_b'
SAM_CKPT_PATH: '../sam_road_repo/sam_ckpts/sam_vit_b_01ec64.pth'

# Fine-tune from an existing SAMRoad checkpoint
PRETRAINED_CKPT: '../checkpoints/cityscale_vitb_512_e10.ckpt'

# ---- Input ----
PATCH_SIZE: 512

# ---- Training ----
BATCH_SIZE: 4
DATA_WORKER_NUM: 24
TRAIN_EPOCHS: 10
BASE_LR: 0.0003
FREEZE_ENCODER: True
ENCODER_LR_FACTOR: 0.1
ENCODER_LORA: False
FOCAL_LOSS: False
USE_SAM_DECODER: False

# ---- Loss ----
ROUTE_LAMBDA_SEG: 1.0
ROUTE_LAMBDA_DIST: 0.0          # Phase 1: seg only (no distance loss)

LR_MILESTONES: [150]

# Class imbalance: pos_weight ≈ (1 - road_density) / road_density
ROAD_POS_WEIGHT: 3.7            # ~21% road density with dilation r=5

# Dice loss weight (0.0 = pure BCE, 0.5 = equal mix, 1.0 = pure Dice)
ROAD_DICE_WEIGHT: 0.5

# Dual-target: BCE against thick mask (recall), Dice against thin mask (precision).
# Produces sharp road boundaries ideal for Eikonal cost landscapes.
ROAD_DUAL_TARGET: True

# ---- Eikonal evaluation parameters (used by SpearmanEvalCallback) ----
# ds and n_iters are DECOUPLED: ds=8 fixed, n_iters controls convergence.
# Ablation: ds=8, n_iters=40, gate=0.8 → Sp~0.756 on GT masks.
ROUTE_EIK_ITERS: 40
ROUTE_EIK_DOWNSAMPLE: 8
ROUTE_EIK_GATE_INIT: 0.80

# Cost function for Eikonal
ROUTE_COST_MODE: 'add'
ROUTE_ADD_ALPHA: 20.0
ROUTE_ADD_GAMMA: 2.0
ROUTE_ADD_BLOCK_ALPHA: 50.0
ROUTE_ADD_BLOCK_SMOOTH: 50.0

# ---- Unused by SAMRoute but required by SAMRoad parent __init__ ----
TOPO_SAMPLE_NUM: 512
TOPONET_VERSION: 'normal'
DATASET: 'mmroute'
